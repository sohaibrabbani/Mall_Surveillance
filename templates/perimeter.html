<html>
  <head>
    <title>Mall Video Surveillance</title>
  </head>
  <body>
  <h1>Mall Video Surveillance</h1>
    <div>
        <h2>Change Perimeter</h2>
        <button id="undo">undo</button>
        <button id="clear">clear</button>
        <button id="submit">submit</button>
        <br/>
        <br/>
        <canvas id="canvas" width="1280" height="720"></canvas>
    </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>
      var polygone = [];
      function draw(){
          var canvas = document.getElementById("canvas");
          var ctx = canvas.getContext("2d");
          image = new Image();
          image.onload = function() {
              ctx.drawImage(image, 0, 0);
              ctx.strokeStyle = "#f00";
              ctx.lineWidth = 2;
              ctx.beginPath();
              for(var i=0; i<polygone.length; i++){
                  ctx.fillRect(polygone[i][0], polygone[i][1], 3, 3);
                  if(i===0){
                      ctx.moveTo(polygone[i][0], polygone[i][1]);
                  }
                  else{
                      ctx.lineTo(polygone[i][0], polygone[i][1]);
                  }
              }
              ctx.closePath();
              ctx.stroke();
          };
          image.src = "../static/top_view_720p.jpg";
      }

      $(document).ready(function() {
          draw();
          $("#canvas").on("click", function(event) {
              var x = event.pageX - this.offsetLeft;
              var y = event.pageY - this.offsetTop;
              polygone.push([x, y]);
              draw()
          });
          $("#undo").on("click", function(event) {
              polygone.pop();
              draw()
          });
          $("#clear").on("click", function(event) {
              polygone = [];
              draw()
          });
          $("#submit").on("click", function(event) {
              var settings = {
                  "url": "/perimeter",
                  "method": "POST",
                  "headers": {
                    "Content-Type": "application/json",
                  },
                  "data": JSON.stringify(polygone),
              };
              $.ajax(settings).done(function (response) {
                  console.log(response);
              });
          });
      });
  </script>
  </body>
</html>
